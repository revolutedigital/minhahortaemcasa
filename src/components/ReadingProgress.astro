---
// Reading Progress Indicator for articles
---

<div id="reading-progress" class="fixed top-0 left-0 right-0 z-[60] h-1 bg-transparent pointer-events-none">
  <div
    id="progress-bar"
    class="h-full bg-gradient-to-r from-leaf-400 via-leaf-500 to-leaf-600 transition-all duration-150 ease-out"
    style="width: 0%"
    role="progressbar"
    aria-valuenow="0"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-label="Progresso de leitura"
  ></div>
</div>

<script>
  const progressBar = document.getElementById('progress-bar');
  const article = document.querySelector('article');

  if (progressBar && article) {
    let ticking = false;

    function updateProgress() {
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      // Calculate progress
      const start = articleTop - windowHeight / 2;
      const end = articleTop + articleHeight - windowHeight / 2;
      const current = scrollTop - start;
      const total = end - start;

      let progress = Math.min(Math.max((current / total) * 100, 0), 100);

      progressBar.style.width = `${progress}%`;
      progressBar.setAttribute('aria-valuenow', Math.round(progress).toString());

      ticking = false;
    }

    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(updateProgress);
        ticking = true;
      }
    });

    // Initial update
    updateProgress();
  }
</script>

<style>
  #reading-progress {
    /* Add subtle shadow to make it more visible */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  #progress-bar {
    transform-origin: left;
    will-change: width;
  }
</style>

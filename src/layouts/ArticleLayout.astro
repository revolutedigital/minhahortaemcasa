---
import Layout from './Layout.astro';
import CTABox from '../components/CTABox.astro';
import ReadingProgress from '../components/ReadingProgress.astro';
import Mascote from '../components/illustrations/Mascote.astro';
import PlantCardIcons from '../components/illustrations/PlantCardIcons.astro';
import ContentIllustration from '../components/illustrations/ContentIllustration.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    pubDate: string;
    updatedDate?: string;
    image?: string;
    category?: string;
    tags?: string[];
    readTime?: string;
  };
  slug?: string;
}

const { frontmatter, slug = '' } = Astro.props;

const formattedDate = new Date(frontmatter.pubDate).toLocaleDateString('pt-BR', {
  day: 'numeric',
  month: 'long',
  year: 'numeric',
});

const schemaMarkup = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "image": frontmatter.image,
  "datePublished": frontmatter.pubDate,
  "dateModified": frontmatter.updatedDate || frontmatter.pubDate,
  "author": {
    "@type": "Organization",
    "name": "Horta em Casa"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Horta em Casa",
    "logo": {
      "@type": "ImageObject",
      "url": "/logo.png"
    }
  }
};
---

<Layout
  title={frontmatter.title}
  description={frontmatter.description}
  image={frontmatter.image}
  type="article"
  publishedTime={frontmatter.pubDate}
>
  <script type="application/ld+json" set:html={JSON.stringify(schemaMarkup)} />

  <!-- Reading Progress Indicator -->
  <ReadingProgress />

  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 relative">
    <!-- Decorative illustrations (hidden on mobile for performance) -->
    <div class="hidden lg:block absolute -left-32 top-20 opacity-20 pointer-events-none">
      <PlantCardIcons type="manjericao" size="lg" />
    </div>
    <div class="hidden lg:block absolute -right-32 top-96 opacity-20 pointer-events-none">
      <PlantCardIcons type="hortela" size="lg" />
    </div>

    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-500 mb-8">
      <ol class="flex items-center gap-2">
        <li><a href="/" class="hover:text-primary-600">Inicio</a></li>
        <li>/</li>
        {frontmatter.category && (
          <>
            <li><a href={`/${frontmatter.category.toLowerCase()}`} class="hover:text-primary-600 capitalize">{frontmatter.category}</a></li>
            <li>/</li>
          </>
        )}
        <li class="text-gray-900 truncate">{frontmatter.title}</li>
      </ol>
    </nav>

    <!-- Header -->
    <header class="mb-8">
      <div class="flex items-center gap-3 mb-4">
        {frontmatter.category && (
          <span class="px-3 py-1 bg-primary-50 text-primary-700 text-sm font-medium rounded-full">
            {frontmatter.category}
          </span>
        )}
        {frontmatter.readTime && (
          <span class="text-gray-500 text-sm">{frontmatter.readTime} de leitura</span>
        )}
      </div>
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4 leading-tight">
        {frontmatter.title}
      </h1>
      <p class="text-xl text-gray-600 mb-6">
        {frontmatter.description}
      </p>
      <div class="flex items-center gap-4 text-sm text-gray-500">
        <time datetime={frontmatter.pubDate}>{formattedDate}</time>
        {frontmatter.updatedDate && (
          <span>
            (Atualizado em {new Date(frontmatter.updatedDate).toLocaleDateString('pt-BR')})
          </span>
        )}
      </div>
    </header>

    <!-- Featured Illustration -->
    {slug && (
      <div class={`w-full aspect-video rounded-xl mb-8 flex items-center justify-center p-8 bg-gradient-to-br ${
        frontmatter.category === 'Plantas' ? 'from-leaf-50 to-leaf-100' :
        frontmatter.category === 'Problemas' ? 'from-amber-50 to-orange-100' :
        frontmatter.category === 'Guias' ? 'from-sky-50 to-blue-100' :
        'from-gray-50 to-gray-100'
      }`}>
        <div class="w-full max-w-xs">
          <ContentIllustration slug={slug} category={frontmatter.category} size="lg" />
        </div>
      </div>
    )}

    <!-- Content -->
    <div class="prose prose-lg max-w-none">
      <slot />
    </div>

    <!-- CTA Box -->
    <div class="mt-12">
      <CTABox
        title="Kit Iniciante: Sua Primeira Horta em 7 Dias"
        description="Guia passo a passo completo para quem nunca plantou nada. De R$ 47 por apenas R$ 19."
        buttonText="Quero Comecar"
        buttonHref="/produtos/kit-iniciante"
        variant="highlight"
        icon="cart"
      />
    </div>

    <!-- Tags -->
    {frontmatter.tags && frontmatter.tags.length > 0 && (
      <div class="mt-8 pt-8 border-t border-gray-100">
        <div class="flex flex-wrap gap-2">
          {frontmatter.tags.map((tag) => (
            <span class="px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full">
              #{tag}
            </span>
          ))}
        </div>
      </div>
    )}

    <!-- Mascote feedback section -->
    <div class="mt-12 bg-gradient-to-br from-leaf-50 to-earth-50 rounded-2xl p-6 sm:p-8">
      <div class="flex flex-col sm:flex-row items-center gap-6">
        <div class="flex-shrink-0">
          <Mascote
            mood={frontmatter.category === 'Guias' ? 'watering' : frontmatter.category === 'Problemas' ? 'thinking' : 'happy'}
            size="md"
          />
        </div>
        <div class="text-center sm:text-left">
          <h3 class="text-lg font-bold text-gray-900 mb-2">
            Gostou do conteudo?
          </h3>
          <p class="text-gray-600 text-sm mb-4">
            Explore mais guias e dicas para sua horta em casa!
          </p>
          <div class="flex flex-wrap gap-3 justify-center sm:justify-start">
            <a href="/plantas" class="inline-flex items-center px-4 py-2 bg-leaf-600 text-white rounded-lg text-sm font-medium hover:bg-leaf-700 transition-colors">
              Ver plantas
            </a>
            <a href="/problemas" class="inline-flex items-center px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors border border-gray-200">
              Resolver problemas
            </a>
          </div>
        </div>
      </div>
    </div>
  </article>
</Layout>
